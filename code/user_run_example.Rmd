---
title: "User Run Example"
author: "Tyler Liddell"
date: '2022-06-21'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The goal of this file is to imitate how a user will eventually want to implement the package. In this way it is similar to the run.R file except that rather than being used to try out the current functionality, it acts as a road map. If this script is able to run, the package is ready for use. 

Load package (pkg stands in for the package name once it's determined. See [R Packages: Name Your Package](https://r-pkgs.org/workflows101.html#naming) for suggestions and conventions.
```{r}
# User will run install.packages("pkg"). If dependencies are properly noted in the DESCRIPTION file under Imports:, this should also install them. Note that this logic does not apply to the next line, library(pkg) only attaches pkg. Best practice is to always call functions from dependencies using package::function() syntax. There are, however, ways around this

library(pkg)
```

Read in data
```{r}
# Weights raster
weights_raster <- read.csv(crop_yield_data)

```

List parameters to use in function arguments
```{r}
climate_data <- 'era5' # era5 is only option for now
climate_variable <- 'prcp' # temp, prcp, or uv
daily_agg <- 'sum' # average or sum; method for aggregating from hourly to daily 
years <- 2005:2010 # any sequence of years 2002:2020
trans <- 'polynomial' # polynomial is only option for now
trans_specs <- 3 # Specs must match the trans type, numeric when trans=polynomial
id_var <- 'GEOID' # Col name in the input_polygons shp that uniquely identifies each polygon 
weights <- TRUE # True to define a second set of weights, FALSE to use only area weights
extent <- 'full'
input_polygons_name <- 'ca_counties' # Name used in saving function outputs; should relate to the polygons used
weights_type <- 'crop' # Added to the name of the output file to indicate what secondary weights are used =
```


Run functions
```{r}
# Resample weights raster
calc_raster_weights(weights_raster = weights_raster,
                    data_source = climate_data,
                    extent = extent)

# Calculate weighted statistics
calc_geoweights(data_source = climate_data,
                input_polygons = input_polygons,
                polygon_id = id_var,
                weights = weights
                #weights_type should also be an argument option
                )

# If we were willing to make a function calc_many_weights() that would be used instead of setting weights = true, we could have something like this
calc_raster_weights(...) %>% calc_many_weights(...)
# Where the resampled weights raster is the first argument in calc_many_weights() and so can be piped in
```


The following packages need to be listed under imports in the description:
ncdf4, data.table, raster, exactextractr, tidyverse, sf, here, crayon, dplyr
